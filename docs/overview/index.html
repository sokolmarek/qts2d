
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../license/">
      
      
        <link rel="next" href="../qgaf/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Overview - QTS2D</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QTS2D" class="md-header__button md-logo" aria-label="QTS2D" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QTS2D
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QTS2D" class="md-nav__button md-logo" aria-label="QTS2D" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    QTS2D
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QTS2D Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding" class="md-nav__link">
    <span class="md-ellipsis">
      encoding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF" class="md-nav__link">
    <span class="md-ellipsis">
      QGAF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QGAF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.transform--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.transform--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF" class="md-nav__link">
    <span class="md-ellipsis">
      QMTF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QMTF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.transform--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.transform--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP" class="md-nav__link">
    <span class="md-ellipsis">
      QRP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QRP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.transform--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.transform--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG" class="md-nav__link">
    <span class="md-ellipsis">
      QSG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QSG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../qgaf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum Gramian Angular Field (QGAF)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../qmtf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum Markov Transition Field (QMTF)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../qrp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum Recurrence Plot (QRP)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../qsg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quantum Spectrogram (QSG)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    References
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../transformers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformers
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding" class="md-nav__link">
    <span class="md-ellipsis">
      encoding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF" class="md-nav__link">
    <span class="md-ellipsis">
      QGAF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QGAF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.transform--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QGAF.transform--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF" class="md-nav__link">
    <span class="md-ellipsis">
      QMTF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QMTF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.transform--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QMTF.transform--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP" class="md-nav__link">
    <span class="md-ellipsis">
      QRP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QRP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.transform--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QRP.transform--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG" class="md-nav__link">
    <span class="md-ellipsis">
      QSG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QSG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qts2d.encoding.QSG.transform" class="md-nav__link">
    <span class="md-ellipsis">
      transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="overview">Overview</h1>
<p>QTS2D provides quantum-inspired methods to encode 1D time series as 2D images. These encodings are useful for machine learning, especially deep learning models that operate on images.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li>Quantum Gramian Angular Field (QGAF)</li>
<li>Quantum Recurrence Plot (QRP)</li>
<li>Quantum Spectrogram (QSG)</li>
<li>Quantum Markov Transition Field (QMTF)</li>
</ul>
<p>Each transformer is implemented as a scikit-learn compatible estimator.</p>


<div class="doc doc-object doc-module">



<a id="qts2d.encoding"></a>
    <div class="doc doc-contents first">

        <p>Quantum encoding algorithms module.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="qts2d.encoding.QGAF" class="doc doc-heading">
            <code>QGAF</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="qts2d.base_transformer.BaseQuantumTransformer">BaseQuantumTransformer</span></code></p>


        <p>Quantum Gramian Angular Field transformer.</p>
<p>Encodes time series into images using quantum approaches inspired by GAF.
Supports two computation methods:
1. 'hadamard': Scales data to [-1, 1], computes angles (phi), then uses the
   Hadamard Test.
2. 'xu': Operates directly on the (optionally scaled) time series
   without computing intermediate angles. Implementation according to
   Xu et al. [1].</p>
<p>If <code>image_size</code> is provided and differs from the input time series length,
Piecewise Aggregate Approximation (PAA) is used for resizing <em>before</em>
encoding.</p>
<h4 id="qts2d.encoding.QGAF--parameters">Parameters</h4>
<p>image_size : int or None, default=None
    The desired size of the output image (image_size x image_size).
    If None, it defaults to the length of the input time series.
    If set to a value different from the input time series length,
    PAA will be used to resize the series before encoding.
method : {'summation', 'difference'}, default='summation'
    Type of Quantum Gramian Angular Field: 'summation' (QGASF) or 
    'difference' (QGADF). Determines the relationship computed 
    between time points.
computation_method : {'hadamard', 'xu'}, default='hadamard'
    The method used to compute the QGAF matrix.
    - 'hadamard': Uses scaling to [-1, 1], calculates angles (phi), and
      computes trigonometric sum/diff via Hadamard test. Requires <code>scaling</code>
      that results in the [-1, 1] range (e.g., 'minmax').
    - 'xu': Computes the matrix directly from the time series values
      (after potential PAA and optional scaling). Does not compute phi.
      Method according to Xu et al. [1].
scaling : str or None, default='minmax'
    Time series scaling method (inherited from BaseQuantumTransformer).
    - If <code>computation_method='angle'</code>, this <em>must</em> scale to [-1, 1]
      (e.g., 'minmax', which is the default).
    - If <code>computation_method='direct'</code>, scaling is optional (<code>None</code>) or
      can use other methods like 'standard'.</p>
<h4 id="qts2d.encoding.QGAF--references">References</h4>
<p>.. [1] Xu, Z., Wang, Y., Feng, X., Wang, Y., Li, Y., &amp; Lin, H. (2024). 
Quantum-enhanced forecasting: Leveraging quantum gramian angular field 
and CNNs for stock return predictions. Finance Research Letters, 67, 105840. 
https://doi.org/10.1016/j.frl.2024.105840</p>
<h4 id="qts2d.encoding.QGAF--examples">Examples</h4>
<p>TODO: Add examples for usage.</p>







              <details class="quote">
                <summary>Source code in <code>qts2d\encoding\qgaf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QGAF</span><span class="p">(</span><span class="n">BaseQuantumTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quantum Gramian Angular Field transformer.</span>

<span class="sd">    Encodes time series into images using quantum approaches inspired by GAF.</span>
<span class="sd">    Supports two computation methods:</span>
<span class="sd">    1. &#39;hadamard&#39;: Scales data to [-1, 1], computes angles (phi), then uses the</span>
<span class="sd">       Hadamard Test.</span>
<span class="sd">    2. &#39;xu&#39;: Operates directly on the (optionally scaled) time series</span>
<span class="sd">       without computing intermediate angles. Implementation according to</span>
<span class="sd">       Xu et al. [1].</span>

<span class="sd">    If `image_size` is provided and differs from the input time series length,</span>
<span class="sd">    Piecewise Aggregate Approximation (PAA) is used for resizing *before*</span>
<span class="sd">    encoding.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_size : int or None, default=None</span>
<span class="sd">        The desired size of the output image (image_size x image_size).</span>
<span class="sd">        If None, it defaults to the length of the input time series.</span>
<span class="sd">        If set to a value different from the input time series length,</span>
<span class="sd">        PAA will be used to resize the series before encoding.</span>
<span class="sd">    method : {&#39;summation&#39;, &#39;difference&#39;}, default=&#39;summation&#39;</span>
<span class="sd">        Type of Quantum Gramian Angular Field: &#39;summation&#39; (QGASF) or </span>
<span class="sd">        &#39;difference&#39; (QGADF). Determines the relationship computed </span>
<span class="sd">        between time points.</span>
<span class="sd">    computation_method : {&#39;hadamard&#39;, &#39;xu&#39;}, default=&#39;hadamard&#39;</span>
<span class="sd">        The method used to compute the QGAF matrix.</span>
<span class="sd">        - &#39;hadamard&#39;: Uses scaling to [-1, 1], calculates angles (phi), and</span>
<span class="sd">          computes trigonometric sum/diff via Hadamard test. Requires `scaling`</span>
<span class="sd">          that results in the [-1, 1] range (e.g., &#39;minmax&#39;).</span>
<span class="sd">        - &#39;xu&#39;: Computes the matrix directly from the time series values</span>
<span class="sd">          (after potential PAA and optional scaling). Does not compute phi.</span>
<span class="sd">          Method according to Xu et al. [1].</span>
<span class="sd">    scaling : str or None, default=&#39;minmax&#39;</span>
<span class="sd">        Time series scaling method (inherited from BaseQuantumTransformer).</span>
<span class="sd">        - If `computation_method=&#39;angle&#39;`, this *must* scale to [-1, 1]</span>
<span class="sd">          (e.g., &#39;minmax&#39;, which is the default).</span>
<span class="sd">        - If `computation_method=&#39;direct&#39;`, scaling is optional (`None`) or</span>
<span class="sd">          can use other methods like &#39;standard&#39;.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Xu, Z., Wang, Y., Feng, X., Wang, Y., Li, Y., &amp; Lin, H. (2024). </span>
<span class="sd">    Quantum-enhanced forecasting: Leveraging quantum gramian angular field </span>
<span class="sd">    and CNNs for stock return predictions. Finance Research Letters, 67, 105840. </span>
<span class="sd">    https://doi.org/10.1016/j.frl.2024.105840</span>

<span class="sd">    Examples</span>
<span class="sd">    ----------</span>
<span class="sd">    TODO: Add examples for usage.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;summation&#39;</span><span class="p">,</span> <span class="n">computation_method</span><span class="o">=</span><span class="s1">&#39;hadamard&#39;</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;minmax&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="n">image_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">computation_method</span> <span class="o">=</span> <span class="n">computation_method</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;summation&#39;</span><span class="p">,</span> <span class="s1">&#39;difference&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method must be &#39;summation&#39; or &#39;difference&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">computation_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hadamard&#39;</span><span class="p">,</span> <span class="s1">&#39;xu&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;computation_method must be &#39;hadamard&#39; or &#39;xu&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">computation_method</span> <span class="o">==</span> <span class="s1">&#39;hadamard&#39;</span> <span class="ow">and</span> <span class="n">scaling</span> <span class="o">!=</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: computation_method=&#39;hadamard&#39; typically requires scaling=&#39;minmax&#39; &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;to ensure data is in [-1, 1] for arccos. Current scaling: &#39;</span><span class="si">{</span><span class="n">scaling</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_scaled</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a time series scaled to [-1, 1] and computes angles phi.</span>

<span class="sd">        Args:</span>
<span class="sd">            ts_scaled (np.ndarray): 1D array scaled to [-1, 1].</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Array of angles (phi) in radians.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ts_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">ts_scaled</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">ts_clipped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phi</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_qgaf_matrix_xu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the GAF-like matrix directly from the time series segment `ts`.</span>
<span class="sd">        This method avoids calculating angles (phi).</span>

<span class="sd">        Args:</span>
<span class="sd">            ts (np.ndarray): 1D array representing a time series segment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The resulting n x n quantum GAF matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
        <span class="n">qgaf_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">pauli_z</span> <span class="o">=</span> <span class="n">Operator</span><span class="o">.</span><span class="n">from_label</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;difference&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">difference</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="n">state</span> <span class="o">=</span> <span class="n">Statevector</span><span class="o">.</span><span class="n">from_instruction</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>
                <span class="n">expectation_Z</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">expectation_value</span><span class="p">(</span><span class="n">pauli_z</span><span class="p">)</span>

                <span class="n">cos_2ab</span> <span class="o">=</span> <span class="n">expectation_Z</span><span class="o">.</span><span class="n">real</span>

                <span class="n">qgaf_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos_2ab</span>

        <span class="k">return</span> <span class="n">qgaf_matrix</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_qgaf_matrix_hadamard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the GAF matrix using the Hadamard Test quantum circuit from angles.</span>
<span class="sd">        Calculates cos(phi_i + phi_j) or sin(phi_i - phi_j).</span>

<span class="sd">        Args:</span>
<span class="sd">            phi (np.ndarray): Array of angles computed from the time series.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The resulting n x n matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">qgaf_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">pauli_z</span> <span class="o">=</span> <span class="n">Operator</span><span class="o">.</span><span class="n">from_label</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">pauli_y</span> <span class="o">=</span> <span class="n">Operator</span><span class="o">.</span><span class="n">from_label</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>

        <span class="n">difference</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;difference&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">difference</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">crz</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">cry</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1">#qc.save_statevector()</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">Statevector</span><span class="o">.</span><span class="n">from_instruction</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">difference</span><span class="p">:</span>
                    <span class="n">expectation_Z_ancilla</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">expectation_value</span><span class="p">(</span><span class="n">pauli_y</span><span class="p">,</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expectation_Z_ancilla</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">expectation_value</span><span class="p">(</span><span class="n">pauli_z</span><span class="p">,</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">qgaf_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">expectation_Z_ancilla</span><span class="o">.</span><span class="n">real</span>

        <span class="k">return</span> <span class="n">qgaf_matrix</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the QGAF transformer.</span>

<span class="sd">        Validates input, and parameters. Determines image size and PAA setup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">            Training input samples.</span>
<span class="sd">        y : None</span>
<span class="sd">            Ignored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : object</span>
<span class="sd">            Returns self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="o">=</span> <span class="n">PiecewiseAggregateApproximation</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform time series into Quantum Gramian Angular Fields.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">            Input time series.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        X_transformed : ndarray of shape (n_samples, image_size, image_size)</span>
<span class="sd">            The QGAF representations of the time series.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_is_fitted&#39;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input shape mismatch: expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> features, got </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">X_resized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">X</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_resized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">qgaf_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">ts_resized</span> <span class="o">=</span> <span class="n">X_resized</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computation_method</span> <span class="o">==</span> <span class="s1">&#39;hadamard&#39;</span><span class="p">:</span>
                <span class="n">ts_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">ts_resized</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_phi</span><span class="p">(</span><span class="n">ts_scaled</span><span class="p">)</span>
                <span class="n">qgaf_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_qgaf_matrix_hadamard</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">computation_method</span> <span class="o">==</span> <span class="s1">&#39;xu&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ts_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">ts_resized</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ts_processed</span> <span class="o">=</span> <span class="n">ts_resized</span>
                <span class="n">qgaf_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_qgaf_matrix_xu</span><span class="p">(</span><span class="n">ts_processed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qgaf_images</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QGAF.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fit the QGAF transformer.</p>
<p>Validates input, and parameters. Determines image size and PAA setup.</p>
<h5 id="qts2d.encoding.QGAF.fit--parameters">Parameters</h5>
<p>X : array-like of shape (n_samples, n_timestamps)
    Training input samples.
y : None
    Ignored.</p>
<h5 id="qts2d.encoding.QGAF.fit--returns">Returns</h5>
<p>self : object
    Returns self.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qgaf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the QGAF transformer.</span>

<span class="sd">    Validates input, and parameters. Determines image size and PAA setup.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">        Training input samples.</span>
<span class="sd">    y : None</span>
<span class="sd">        Ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self : object</span>
<span class="sd">        Returns self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="o">=</span> <span class="n">PiecewiseAggregateApproximation</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QGAF.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transform time series into Quantum Gramian Angular Fields.</p>
<h5 id="qts2d.encoding.QGAF.transform--parameters">Parameters</h5>
<p>X : array-like of shape (n_samples, n_timestamps)
    Input time series.</p>
<h5 id="qts2d.encoding.QGAF.transform--returns">Returns</h5>
<p>X_transformed : ndarray of shape (n_samples, image_size, image_size)
    The QGAF representations of the time series.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qgaf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform time series into Quantum Gramian Angular Fields.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">        Input time series.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X_transformed : ndarray of shape (n_samples, image_size, image_size)</span>
<span class="sd">        The QGAF representations of the time series.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_is_fitted&#39;</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input shape mismatch: expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> features, got </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">X_resized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">X</span>

    <span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_resized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">qgaf_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">ts_resized</span> <span class="o">=</span> <span class="n">X_resized</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">computation_method</span> <span class="o">==</span> <span class="s1">&#39;hadamard&#39;</span><span class="p">:</span>
            <span class="n">ts_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">ts_resized</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_phi</span><span class="p">(</span><span class="n">ts_scaled</span><span class="p">)</span>
            <span class="n">qgaf_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_qgaf_matrix_hadamard</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">computation_method</span> <span class="o">==</span> <span class="s1">&#39;xu&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ts_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">ts_resized</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ts_processed</span> <span class="o">=</span> <span class="n">ts_resized</span>
            <span class="n">qgaf_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_qgaf_matrix_xu</span><span class="p">(</span><span class="n">ts_processed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">qgaf_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="qts2d.encoding.QMTF" class="doc doc-heading">
            <code>QMTF</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="qts2d.base_transformer.BaseQuantumTransformer">BaseQuantumTransformer</span></code></p>


        <p>Quantum Markov Transition Field (QMTF).</p>
<p>This implementation uses Qiskit to represent transition probabilities
from a classically computed Markov Transition Matrix (MTM) using quantum states.
The MTF values are then derived from these quantum states.
Time series are first discretized into bins. Optional scaling can be applied
before discretization. The image size can be adjusted, with aggregation
applied if the target image size is smaller than the number of timestamps.</p>
<h4 id="qts2d.encoding.QMTF--parameters">Parameters</h4>
<p>image_size : int or float, default=1.0
    Shape of the output images. If float, it represents a percentage
    of the size of each time series and must be between 0 and 1.
    If int, it's the exact size.
n_bins : int, default=8
    Number of bins for discretization.
discretizer_strategy : {'uniform', 'quantile', 'normal'}, default='quantile'
    Strategy used by KBinsDiscretizer to define the widths of the bins.
    Actual available strategies depend on whether pyts is installed.
    Common are 'uniform', 'quantile', 'normal'.
overlapping : bool, default=False
    Parameter for the segmentation function. If True, segments may overlap
    (behavior depends on the specific segmentation function from pyts or fallback).
flatten : bool, default=False
    If True, images are flattened to be one-dimensional.
scaling : str or None, default='minmax'
    Time series scaling method applied <em>before</em> discretization.
    Inherited from BaseQuantumTransformer. Options: 'minmax' (scales to [-1,1]),
    'standard' (Z-score normalization), or None (no scaling).</p>
<h4 id="qts2d.encoding.QMTF--references">References</h4>
<p>.. [1] Z. Wang and T. Oates, "Encoding Time Series as Images for Visual
       Inspection and Classification Using Tiled Convolutional Neural
       Networks." AAAI Workshop (2015).</p>







              <details class="quote">
                <summary>Source code in <code>qts2d\encoding\qmtf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QMTF</span><span class="p">(</span><span class="n">BaseQuantumTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantum Markov Transition Field (QMTF).</span>

<span class="sd">    This implementation uses Qiskit to represent transition probabilities</span>
<span class="sd">    from a classically computed Markov Transition Matrix (MTM) using quantum states.</span>
<span class="sd">    The MTF values are then derived from these quantum states.</span>
<span class="sd">    Time series are first discretized into bins. Optional scaling can be applied</span>
<span class="sd">    before discretization. The image size can be adjusted, with aggregation</span>
<span class="sd">    applied if the target image size is smaller than the number of timestamps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_size : int or float, default=1.0</span>
<span class="sd">        Shape of the output images. If float, it represents a percentage</span>
<span class="sd">        of the size of each time series and must be between 0 and 1.</span>
<span class="sd">        If int, it&#39;s the exact size.</span>
<span class="sd">    n_bins : int, default=8</span>
<span class="sd">        Number of bins for discretization.</span>
<span class="sd">    discretizer_strategy : {&#39;uniform&#39;, &#39;quantile&#39;, &#39;normal&#39;}, default=&#39;quantile&#39;</span>
<span class="sd">        Strategy used by KBinsDiscretizer to define the widths of the bins.</span>
<span class="sd">        Actual available strategies depend on whether pyts is installed.</span>
<span class="sd">        Common are &#39;uniform&#39;, &#39;quantile&#39;, &#39;normal&#39;.</span>
<span class="sd">    overlapping : bool, default=False</span>
<span class="sd">        Parameter for the segmentation function. If True, segments may overlap</span>
<span class="sd">        (behavior depends on the specific segmentation function from pyts or fallback).</span>
<span class="sd">    flatten : bool, default=False</span>
<span class="sd">        If True, images are flattened to be one-dimensional.</span>
<span class="sd">    scaling : str or None, default=&#39;minmax&#39;</span>
<span class="sd">        Time series scaling method applied *before* discretization.</span>
<span class="sd">        Inherited from BaseQuantumTransformer. Options: &#39;minmax&#39; (scales to [-1,1]),</span>
<span class="sd">        &#39;standard&#39; (Z-score normalization), or None (no scaling).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Z. Wang and T. Oates, &quot;Encoding Time Series as Images for Visual</span>
<span class="sd">           Inspection and Classification Using Tiled Convolutional Neural</span>
<span class="sd">           Networks.&quot; AAAI Workshop (2015).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">discretizer_strategy</span><span class="o">=</span><span class="s1">&#39;quantile&#39;</span><span class="p">,</span>
                 <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;minmax&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="n">image_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span> <span class="o">=</span> <span class="n">n_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discretizer_strategy</span> <span class="o">=</span> <span class="n">discretizer_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlapping</span> <span class="o">=</span> <span class="n">overlapping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">flatten</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the QMTF transformer.</span>

<span class="sd">        Validates parameters and pre-calculates image size and qubit requirements.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">            Training input samples.</span>
<span class="sd">        y : None</span>
<span class="sd">            Ignored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : object</span>
<span class="sd">            Returns self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits_for_bins_</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform each time series into a Quantum MTF image.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array-like, shape = (n_samples, n_timestamps)</span>
<span class="sd">            Input data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        X_new : array-like</span>
<span class="sd">            Transformed data. Shape is (n_samples, image_size, image_size) or</span>
<span class="sd">            (n_samples, image_size * image_size) if flatten=True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input has </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> features, but transformer was fitted with &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> features.&quot;</span>
            <span class="p">)</span>

        <span class="n">simulator</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;statevector&#39;</span><span class="p">)</span>
        <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_timestamps</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">X_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">discretizer</span> <span class="o">=</span> <span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discretizer_strategy</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">&#39;ordinal&#39;</span><span class="p">)</span>
        <span class="n">X_binned</span> <span class="o">=</span> <span class="n">discretizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_processed</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">X_binned</span> <span class="o">=</span> <span class="n">X_binned</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">X_mtm_counts</span> <span class="o">=</span> <span class="n">_mtf_counts</span><span class="p">(</span>
            <span class="n">X_binned</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span>
        <span class="p">)</span>

        <span class="n">X_mtm_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X_mtm_counts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span> 
            <span class="n">sample_mtm_counts</span> <span class="o">=</span> <span class="n">X_mtm_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sum_of_rows</span> <span class="o">=</span> <span class="n">sample_mtm_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">non_zero_rows_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_of_rows</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1e-9</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">non_zero_rows_mask</span><span class="p">):</span>
                <span class="n">X_mtm_probs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">non_zero_rows_mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> \
                    <span class="n">sample_mtm_counts</span><span class="p">[</span><span class="n">non_zero_rows_mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">sum_of_rows</span><span class="p">[</span><span class="n">non_zero_rows_mask</span><span class="p">]</span>

        <span class="n">X_qmtf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits_for_bins_</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">sample_mtm_prob_dist</span> <span class="o">=</span> <span class="n">X_mtm_probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
            <span class="n">sample_binned_ts</span> <span class="o">=</span> <span class="n">X_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>    

            <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_timestamps</span><span class="p">):</span>
                <span class="n">source_bin_idx</span> <span class="o">=</span> <span class="n">sample_binned_ts</span><span class="p">[</span><span class="n">t1</span><span class="p">]</span>
                <span class="n">probs_from_source_bin</span> <span class="o">=</span> <span class="n">sample_mtm_prob_dist</span><span class="p">[</span><span class="n">source_bin_idx</span><span class="p">,</span> <span class="p">:]</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">probs_from_source_bin</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">X_qmtf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">continue</span> 

                <span class="n">desired_amplitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">sqrt_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">probs_from_source_bin</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                <span class="n">norm_sqrt_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sqrt_p</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">norm_sqrt_p</span> <span class="o">&gt;</span> <span class="mf">1e-9</span><span class="p">:</span> 
                    <span class="n">normalized_sqrt_p</span> <span class="o">=</span> <span class="n">sqrt_p</span> <span class="o">/</span> <span class="n">norm_sqrt_p</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">normalized_sqrt_p</span> <span class="o">=</span> <span class="n">sqrt_p</span> 

                <span class="n">desired_amplitudes</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized_sqrt_p</span>

                <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">desired_amplitudes</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">save_statevector</span><span class="p">()</span> 

                <span class="n">result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">statevector</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_timestamps</span><span class="p">):</span>
                    <span class="n">target_bin_idx</span> <span class="o">=</span> <span class="n">sample_binned_ts</span><span class="p">[</span><span class="n">t2</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">target_bin_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">statevector</span><span class="o">.</span><span class="n">data</span><span class="p">):</span> 
                        <span class="n">amplitude_of_target_bin</span> <span class="o">=</span> <span class="n">statevector</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">target_bin_idx</span><span class="p">]</span>
                        <span class="n">probability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amplitude_of_target_bin</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                        <span class="n">X_qmtf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span> <span class="o">=</span> <span class="n">probability</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">X_qmtf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> 

        <span class="n">window_size</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">n_timestamps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remainder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X_aqmtf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">X_qmtf</span><span class="p">,</span> 
                <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span> <span class="n">window_size</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">window_size</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">segmentation</span><span class="p">(</span>
                <span class="n">n_timestamps</span><span class="o">=</span><span class="n">n_timestamps</span><span class="p">,</span>
                <span class="n">n_segments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span>
                <span class="n">overlapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping</span>
            <span class="p">)</span>

            <span class="n">X_aqmtf</span> <span class="o">=</span> <span class="n">_aggregated_mtf</span><span class="p">(</span>
                <span class="n">X_qmtf</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X_aqmtf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X_aqmtf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate parameters and return internal image size.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;image_size&#39; must be an integer or a float.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">&lt;=</span> <span class="n">n_timestamps</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If &#39;image_size&#39; is an integer (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="si">}</span><span class="s2">), it must be &gt;= 1 &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and &lt;= n_timestamps (</span><span class="si">{</span><span class="n">n_timestamps</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>
            <span class="n">image_size_internal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If &#39;image_size&#39; is a float (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="si">}</span><span class="s2">), it must be &gt; 0. and &lt;= 1.&quot;</span>
                <span class="p">)</span>
            <span class="n">image_size_internal</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">*</span> <span class="n">n_timestamps</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;n_bins&#39; must be an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;n_bins&#39; (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="si">}</span><span class="s2">) must be &gt;= 2.&quot;</span><span class="p">)</span>

        <span class="n">allowed_strategies</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;quantile&#39;</span><span class="p">,</span> <span class="s1">&#39;kmeans&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discretizer_strategy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_strategies</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: &#39;discretizer_strategy&#39; (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">discretizer_strategy</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;is not in the listed set </span><span class="si">{</span><span class="n">allowed_strategies</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Ensure the chosen KBinsDiscretizer backend supports it.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_size_internal</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QMTF.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fit the QMTF transformer.</p>
<p>Validates parameters and pre-calculates image size and qubit requirements.</p>
<h5 id="qts2d.encoding.QMTF.fit--parameters">Parameters</h5>
<p>X : array-like of shape (n_samples, n_timestamps)
    Training input samples.
y : None
    Ignored.</p>
<h5 id="qts2d.encoding.QMTF.fit--returns">Returns</h5>
<p>self : object
    Returns self.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qmtf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit the QMTF transformer.</span>

<span class="sd">    Validates parameters and pre-calculates image size and qubit requirements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">        Training input samples.</span>
<span class="sd">    y : None</span>
<span class="sd">        Ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self : object</span>
<span class="sd">        Returns self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits_for_bins_</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">))</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QMTF.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transform each time series into a Quantum MTF image.</p>
<h5 id="qts2d.encoding.QMTF.transform--parameters">Parameters</h5>
<p>X : array-like, shape = (n_samples, n_timestamps)
    Input data.</p>
<h5 id="qts2d.encoding.QMTF.transform--returns">Returns</h5>
<p>X_new : array-like
    Transformed data. Shape is (n_samples, image_size, image_size) or
    (n_samples, image_size * image_size) if flatten=True.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qmtf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform each time series into a Quantum MTF image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : array-like, shape = (n_samples, n_timestamps)</span>
<span class="sd">        Input data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X_new : array-like</span>
<span class="sd">        Transformed data. Shape is (n_samples, image_size, image_size) or</span>
<span class="sd">        (n_samples, image_size * image_size) if flatten=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Input has </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> features, but transformer was fitted with &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> features.&quot;</span>
        <span class="p">)</span>

    <span class="n">simulator</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;statevector&#39;</span><span class="p">)</span>
    <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_timestamps</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">X_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">discretizer</span> <span class="o">=</span> <span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discretizer_strategy</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">&#39;ordinal&#39;</span><span class="p">)</span>
    <span class="n">X_binned</span> <span class="o">=</span> <span class="n">discretizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_processed</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">X_binned</span> <span class="o">=</span> <span class="n">X_binned</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">X_mtm_counts</span> <span class="o">=</span> <span class="n">_mtf_counts</span><span class="p">(</span>
        <span class="n">X_binned</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span>
    <span class="p">)</span>

    <span class="n">X_mtm_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X_mtm_counts</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span> 
        <span class="n">sample_mtm_counts</span> <span class="o">=</span> <span class="n">X_mtm_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">sum_of_rows</span> <span class="o">=</span> <span class="n">sample_mtm_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">non_zero_rows_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_of_rows</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">1e-9</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">non_zero_rows_mask</span><span class="p">):</span>
            <span class="n">X_mtm_probs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">non_zero_rows_mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> \
                <span class="n">sample_mtm_counts</span><span class="p">[</span><span class="n">non_zero_rows_mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">sum_of_rows</span><span class="p">[</span><span class="n">non_zero_rows_mask</span><span class="p">]</span>

    <span class="n">X_qmtf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">))</span>
    <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_qubits_for_bins_</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">sample_mtm_prob_dist</span> <span class="o">=</span> <span class="n">X_mtm_probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">sample_binned_ts</span> <span class="o">=</span> <span class="n">X_binned</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>    

        <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_timestamps</span><span class="p">):</span>
            <span class="n">source_bin_idx</span> <span class="o">=</span> <span class="n">sample_binned_ts</span><span class="p">[</span><span class="n">t1</span><span class="p">]</span>
            <span class="n">probs_from_source_bin</span> <span class="o">=</span> <span class="n">sample_mtm_prob_dist</span><span class="p">[</span><span class="n">source_bin_idx</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">probs_from_source_bin</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">X_qmtf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">continue</span> 

            <span class="n">desired_amplitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="n">sqrt_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">probs_from_source_bin</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">norm_sqrt_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sqrt_p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">norm_sqrt_p</span> <span class="o">&gt;</span> <span class="mf">1e-9</span><span class="p">:</span> 
                <span class="n">normalized_sqrt_p</span> <span class="o">=</span> <span class="n">sqrt_p</span> <span class="o">/</span> <span class="n">norm_sqrt_p</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">normalized_sqrt_p</span> <span class="o">=</span> <span class="n">sqrt_p</span> 

            <span class="n">desired_amplitudes</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized_sqrt_p</span>

            <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">desired_amplitudes</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">save_statevector</span><span class="p">()</span> 

            <span class="n">result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">statevector</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_statevector</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_timestamps</span><span class="p">):</span>
                <span class="n">target_bin_idx</span> <span class="o">=</span> <span class="n">sample_binned_ts</span><span class="p">[</span><span class="n">t2</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">target_bin_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">statevector</span><span class="o">.</span><span class="n">data</span><span class="p">):</span> 
                    <span class="n">amplitude_of_target_bin</span> <span class="o">=</span> <span class="n">statevector</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">target_bin_idx</span><span class="p">]</span>
                    <span class="n">probability</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amplitude_of_target_bin</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">X_qmtf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span> <span class="o">=</span> <span class="n">probability</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">X_qmtf</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> 

    <span class="n">window_size</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">n_timestamps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">remainder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">X_aqmtf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="n">X_qmtf</span><span class="p">,</span> 
            <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span> <span class="n">window_size</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">window_size</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">segmentation</span><span class="p">(</span>
            <span class="n">n_timestamps</span><span class="o">=</span><span class="n">n_timestamps</span><span class="p">,</span>
            <span class="n">n_segments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span>
            <span class="n">overlapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping</span>
        <span class="p">)</span>

        <span class="n">X_aqmtf</span> <span class="o">=</span> <span class="n">_aggregated_mtf</span><span class="p">(</span>
            <span class="n">X_qmtf</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size_internal_</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">X_aqmtf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_aqmtf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="qts2d.encoding.QRP" class="doc doc-heading">
            <code>QRP</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="qts2d.base_transformer.BaseQuantumTransformer">BaseQuantumTransformer</span></code></p>


        <p>Quantum Recurrence Plot transformer using Fidelity Kernel.</p>
<p>Encodes time series into images representing quantum distances
between trajectories extracted from the original time series. The distance
is derived from the fidelity between quantum states encoded using a
feature map (e.g., ZFeatureMap), calculated via FidelityStatevectorKernel.</p>
<h4 id="qts2d.encoding.QRP--parameters">Parameters</h4>
<p>dimension : int, default=1
    Dimension of the trajectory (embedding dimension). This also serves as
    the <code>feature_dimension</code> for the quantum feature map. Must be &gt;= 1.
time_delay : int, default=1
    Time gap between two back-to-back points of the trajectory. Must be &gt;= 1.
feature_map_reps : int, default=2
    Number of repetitions for the feature map circuit (e.g., <code>reps</code> for ZFeatureMap).
threshold : float, 'point', 'distance' or None, default=None
    Threshold for the quantum distance to binarize the plot.
    Distance is calculated as <code>sqrt(1 - fidelity^2)</code>.
    - None: The recurrence plot contains the raw quantum distances.
    - 'point': Threshold computed such that <code>percentage</code>% of points are
      below it (closer than threshold).
    - 'distance': Threshold is <code>percentage</code>% of the maximum quantum distance
      found in the plot.
    - float: A fixed distance threshold. Points with distance &lt;= threshold
      are marked as 1.
percentage : float, default=10
    Percentage used when <code>threshold</code> is 'point' or 'distance'. Must be
    between 0 and 100.
flatten : bool, default=False
    If True, flatten the output image into a 1D array.
scaling : str or None, default='minmax'
    Time series scaling method applied <em>before</em> trajectory extraction and
    quantum encoding. Inherited from <code>BaseQuantumTransformer</code>. Options:
    'minmax', 'standard', None. Scaling is recommended for feature maps.</p>
<h4 id="qts2d.encoding.QRP--references">References</h4>
<p>.. [1] J.-P Eckmann, S. Oliffson Kamphorst and D Ruelle, "Recurrence
Plots of Dynamical Systems". Europhysics Letters (1987).</p>







              <details class="quote">
                <summary>Source code in <code>qts2d\encoding\qrp.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QRP</span><span class="p">(</span><span class="n">BaseQuantumTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quantum Recurrence Plot transformer using Fidelity Kernel.</span>

<span class="sd">    Encodes time series into images representing quantum distances</span>
<span class="sd">    between trajectories extracted from the original time series. The distance</span>
<span class="sd">    is derived from the fidelity between quantum states encoded using a</span>
<span class="sd">    feature map (e.g., ZFeatureMap), calculated via FidelityStatevectorKernel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dimension : int, default=1</span>
<span class="sd">        Dimension of the trajectory (embedding dimension). This also serves as</span>
<span class="sd">        the `feature_dimension` for the quantum feature map. Must be &gt;= 1.</span>
<span class="sd">    time_delay : int, default=1</span>
<span class="sd">        Time gap between two back-to-back points of the trajectory. Must be &gt;= 1.</span>
<span class="sd">    feature_map_reps : int, default=2</span>
<span class="sd">        Number of repetitions for the feature map circuit (e.g., `reps` for ZFeatureMap).</span>
<span class="sd">    threshold : float, &#39;point&#39;, &#39;distance&#39; or None, default=None</span>
<span class="sd">        Threshold for the quantum distance to binarize the plot.</span>
<span class="sd">        Distance is calculated as `sqrt(1 - fidelity^2)`.</span>
<span class="sd">        - None: The recurrence plot contains the raw quantum distances.</span>
<span class="sd">        - &#39;point&#39;: Threshold computed such that `percentage`% of points are</span>
<span class="sd">          below it (closer than threshold).</span>
<span class="sd">        - &#39;distance&#39;: Threshold is `percentage`% of the maximum quantum distance</span>
<span class="sd">          found in the plot.</span>
<span class="sd">        - float: A fixed distance threshold. Points with distance &lt;= threshold</span>
<span class="sd">          are marked as 1.</span>
<span class="sd">    percentage : float, default=10</span>
<span class="sd">        Percentage used when `threshold` is &#39;point&#39; or &#39;distance&#39;. Must be</span>
<span class="sd">        between 0 and 100.</span>
<span class="sd">    flatten : bool, default=False</span>
<span class="sd">        If True, flatten the output image into a 1D array.</span>
<span class="sd">    scaling : str or None, default=&#39;minmax&#39;</span>
<span class="sd">        Time series scaling method applied *before* trajectory extraction and</span>
<span class="sd">        quantum encoding. Inherited from `BaseQuantumTransformer`. Options:</span>
<span class="sd">        &#39;minmax&#39;, &#39;standard&#39;, None. Scaling is recommended for feature maps.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] J.-P Eckmann, S. Oliffson Kamphorst and D Ruelle, &quot;Recurrence</span>
<span class="sd">    Plots of Dynamical Systems&quot;. Europhysics Letters (1987).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">feature_map_reps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;minmax&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="n">dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span> <span class="o">=</span> <span class="n">time_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_map_reps</span> <span class="o">=</span> <span class="n">feature_map_reps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage</span> <span class="o">=</span> <span class="n">percentage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">flatten</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`dimension` must be a positive integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`time_delay` must be a positive integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_map_reps</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_map_reps</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`feature_map_reps` must be a positive integer.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">]</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`threshold` must be None, &#39;point&#39;, &#39;distance&#39;, or a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Numeric `threshold` must be non-negative.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percentage</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">percentage</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`percentage` must be between 0 and 100.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`flatten` must be a boolean.&quot;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_trajectory_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_timestamps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate dimension and time_delay against timestamps and calculate sizes.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_timestamps (int): Number of timestamps in the input time series.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_trajectories</span> <span class="o">=</span> <span class="n">n_timestamps</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_trajectories</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The number of trajectories (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_trajectories</span><span class="si">}</span><span class="s2">) must be positive. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Input time series length (</span><span class="si">{</span><span class="n">n_timestamps</span><span class="si">}</span><span class="s2">) is too short for the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;chosen `dimension` (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="si">}</span><span class="s2">) and `time_delay` (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span><span class="si">}</span><span class="s2">). &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Required length &gt;= 1 + (dimension - 1) * time_delay = </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_trajectories</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_qrp_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the Quantum Recurrence Plot matrix for a single time series</span>
<span class="sd">        using FidelityStatevectorKernel.</span>

<span class="sd">        Args:</span>
<span class="sd">            ts (np.ndarray): 1D array representing a time series segment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The resulting n x n quantum recurrence plot matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trajectories</span> <span class="o">=</span> <span class="n">_trajectories</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_delay</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">trajectories</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">trajectories</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">feature_map</span> <span class="o">=</span> <span class="n">ZFeatureMap</span><span class="p">(</span><span class="n">feature_dimension</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_map_reps</span><span class="p">)</span>

        <span class="n">kernel</span> <span class="o">=</span> <span class="n">FidelityStatevectorKernel</span><span class="p">(</span><span class="n">feature_map</span><span class="o">=</span><span class="n">feature_map</span><span class="p">)</span>

        <span class="n">fidelity_matrix</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_vec</span><span class="o">=</span><span class="n">trajectories</span><span class="p">)</span>

        <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">fidelity_matrix</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">==</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
                <span class="n">percentile_k</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">percentage</span><span class="p">))</span>
                <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">distance_matrix</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">percentile_k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">threshold_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">percentile_k</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                     <span class="n">threshold_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">distance_matrix</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">==</span> <span class="s1">&#39;distance&#39;</span><span class="p">:</span>
                <span class="n">max_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">max_dist</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">threshold_val</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">threshold_val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percentage</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_dist</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">threshold_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>

            <span class="n">binary_qrp_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">distance_matrix</span> <span class="o">&lt;=</span> <span class="n">threshold_val</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">binary_qrp_matrix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">distance_matrix</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the QRP transformer.</span>

<span class="sd">        Validates input and parameters. Determines trajectory settings based on</span>
<span class="sd">        input data dimensions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">            Training input samples.</span>
<span class="sd">        y : None</span>
<span class="sd">            Ignored. Present for compatibility with scikit-learn pipelines.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : object</span>
<span class="sd">            Returns the fitted transformer instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_trajectory_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform time series into Quantum Recurrence Plots using Fidelity Kernel.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">            Input time series to transform.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        X_transformed : ndarray</span>
<span class="sd">            The QRP representations of the time series.</span>
<span class="sd">            Shape is (n_samples, image_size, image_size) or</span>
<span class="sd">            (n_samples, image_size * image_size) if `flatten=True`.</span>
<span class="sd">            `image_size` equals the number of trajectories.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_is_fitted&#39;</span><span class="p">,</span> <span class="s1">&#39;_n_trajectories&#39;</span><span class="p">,</span> <span class="s1">&#39;_image_size&#39;</span><span class="p">])</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input shape mismatch: transformer was fitted with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;timestamps, but input has </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> timestamps.&quot;</span>
            <span class="p">)</span>

        <span class="n">X_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
             <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="k">else</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
             <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>

        <span class="n">qrp_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">qrp_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_qrp_matrix</span><span class="p">(</span><span class="n">X_processed</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qrp_images</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qrp_images</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QRP.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fit the QRP transformer.</p>
<p>Validates input and parameters. Determines trajectory settings based on
input data dimensions.</p>
<h5 id="qts2d.encoding.QRP.fit--parameters">Parameters</h5>
<p>X : array-like of shape (n_samples, n_timestamps)
    Training input samples.
y : None
    Ignored. Present for compatibility with scikit-learn pipelines.</p>
<h5 id="qts2d.encoding.QRP.fit--returns">Returns</h5>
<p>self : object
    Returns the fitted transformer instance.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qrp.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the QRP transformer.</span>

<span class="sd">    Validates input and parameters. Determines trajectory settings based on</span>
<span class="sd">    input data dimensions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">        Training input samples.</span>
<span class="sd">    y : None</span>
<span class="sd">        Ignored. Present for compatibility with scikit-learn pipelines.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self : object</span>
<span class="sd">        Returns the fitted transformer instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_trajectory_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QRP.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transform time series into Quantum Recurrence Plots using Fidelity Kernel.</p>
<h5 id="qts2d.encoding.QRP.transform--parameters">Parameters</h5>
<p>X : array-like of shape (n_samples, n_timestamps)
    Input time series to transform.</p>
<h5 id="qts2d.encoding.QRP.transform--returns">Returns</h5>
<p>X_transformed : ndarray
    The QRP representations of the time series.
    Shape is (n_samples, image_size, image_size) or
    (n_samples, image_size * image_size) if <code>flatten=True</code>.
    <code>image_size</code> equals the number of trajectories.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qrp.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform time series into Quantum Recurrence Plots using Fidelity Kernel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : array-like of shape (n_samples, n_timestamps)</span>
<span class="sd">        Input time series to transform.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X_transformed : ndarray</span>
<span class="sd">        The QRP representations of the time series.</span>
<span class="sd">        Shape is (n_samples, image_size, image_size) or</span>
<span class="sd">        (n_samples, image_size * image_size) if `flatten=True`.</span>
<span class="sd">        `image_size` equals the number of trajectories.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_is_fitted&#39;</span><span class="p">,</span> <span class="s1">&#39;_n_trajectories&#39;</span><span class="p">,</span> <span class="s1">&#39;_image_size&#39;</span><span class="p">])</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Input shape mismatch: transformer was fitted with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;timestamps, but input has </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> timestamps.&quot;</span>
        <span class="p">)</span>

    <span class="n">X_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="k">else</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">output_shape</span><span class="p">)</span>

    <span class="n">qrp_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_size</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">qrp_images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_qrp_matrix</span><span class="p">(</span><span class="n">X_processed</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">qrp_images</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">qrp_images</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="qts2d.encoding.QSG" class="doc doc-heading">
            <code>QSG</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="qts2d.base_transformer.BaseQuantumTransformer">BaseQuantumTransformer</span></code></p>


        <p>Quantum Spectrogram transformer.</p>
<p>Encodes time series into spectrograms using Quantum Fourier Transform (QFT)
on windowed segments of the time series.</p>
<h4 id="qts2d.encoding.QSG--parameters">Parameters</h4>
<p>segment_length : int, default=128
    Length of each segment for QFT. Must be a power of 2.
    This also determines the number of qubits used for QFT (log2(segment_length)).
overlap_ratio : float, default=0.5
    Ratio of segment_length for overlap between consecutive segments.
    Must be in the range [0, 1). For example, 0.5 means 50% overlap.
window_name : str or callable, default='hann'
    The window function to apply to each segment. See <code>scipy.signal.get_window</code>.
shots : int, default=100
    Number of shots for quantum circuit execution when simulating measurements.
    Higher shots reduce variance in the estimated probabilities.
scaling : str or None, default='minmax'
    Method to scale the input time series before segmentation and encoding.
    Inherited from <code>BaseQuantumTransformer</code>. Options: 'minmax', 'standard', None.
flatten : bool, default=False
    If True, flatten the output spectrogram for each sample into a 1D array.
    The shape will be (n_samples, num_frequency_bins * num_time_segments).
    If False, the shape will be (n_samples, num_frequency_bins, num_time_segments).</p>
<h4 id="qts2d.encoding.QSG--attributes">Attributes</h4>
<p>n_features_in_ : int
    The number of features (timestamps) seen during <code>fit</code>.
_n_qubits : int
    Number of qubits required, calculated as log2(segment_length).
_overlap_samples : int
    Number of samples for overlap, calculated from overlap_ratio.
_stride : int
    Step size between start of consecutive segments.
_window : np.ndarray
    The windowing array.
_num_freq_bins : int
    Number of frequency bins in the output spectrogram (segment_length / 2).
_num_time_segments : int
    Number of time segments (frames) in the output spectrogram, determined during fit.
_effective_length_for_transform : int
    The length to which input series are padded/truncated in <code>transform</code>
    to ensure a fixed number of time segments.
_is_fitted : bool
    True if the transformer has been fitted.</p>







              <details class="quote">
                <summary>Source code in <code>qts2d\encoding\qsg.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QSG</span><span class="p">(</span><span class="n">BaseQuantumTransformer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quantum Spectrogram transformer.</span>

<span class="sd">    Encodes time series into spectrograms using Quantum Fourier Transform (QFT)</span>
<span class="sd">    on windowed segments of the time series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    segment_length : int, default=128</span>
<span class="sd">        Length of each segment for QFT. Must be a power of 2.</span>
<span class="sd">        This also determines the number of qubits used for QFT (log2(segment_length)).</span>
<span class="sd">    overlap_ratio : float, default=0.5</span>
<span class="sd">        Ratio of segment_length for overlap between consecutive segments.</span>
<span class="sd">        Must be in the range [0, 1). For example, 0.5 means 50% overlap.</span>
<span class="sd">    window_name : str or callable, default=&#39;hann&#39;</span>
<span class="sd">        The window function to apply to each segment. See `scipy.signal.get_window`.</span>
<span class="sd">    shots : int, default=100</span>
<span class="sd">        Number of shots for quantum circuit execution when simulating measurements.</span>
<span class="sd">        Higher shots reduce variance in the estimated probabilities.</span>
<span class="sd">    scaling : str or None, default=&#39;minmax&#39;</span>
<span class="sd">        Method to scale the input time series before segmentation and encoding.</span>
<span class="sd">        Inherited from `BaseQuantumTransformer`. Options: &#39;minmax&#39;, &#39;standard&#39;, None.</span>
<span class="sd">    flatten : bool, default=False</span>
<span class="sd">        If True, flatten the output spectrogram for each sample into a 1D array.</span>
<span class="sd">        The shape will be (n_samples, num_frequency_bins * num_time_segments).</span>
<span class="sd">        If False, the shape will be (n_samples, num_frequency_bins, num_time_segments).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    n_features_in_ : int</span>
<span class="sd">        The number of features (timestamps) seen during `fit`.</span>
<span class="sd">    _n_qubits : int</span>
<span class="sd">        Number of qubits required, calculated as log2(segment_length).</span>
<span class="sd">    _overlap_samples : int</span>
<span class="sd">        Number of samples for overlap, calculated from overlap_ratio.</span>
<span class="sd">    _stride : int</span>
<span class="sd">        Step size between start of consecutive segments.</span>
<span class="sd">    _window : np.ndarray</span>
<span class="sd">        The windowing array.</span>
<span class="sd">    _num_freq_bins : int</span>
<span class="sd">        Number of frequency bins in the output spectrogram (segment_length / 2).</span>
<span class="sd">    _num_time_segments : int</span>
<span class="sd">        Number of time segments (frames) in the output spectrogram, determined during fit.</span>
<span class="sd">    _effective_length_for_transform : int</span>
<span class="sd">        The length to which input series are padded/truncated in `transform`</span>
<span class="sd">        to ensure a fixed number of time segments.</span>
<span class="sd">    _is_fitted : bool</span>
<span class="sd">        True if the transformer has been fitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">overlap_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">window_name</span><span class="o">=</span><span class="s1">&#39;hann&#39;</span><span class="p">,</span>
                 <span class="n">shots</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;minmax&#39;</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">=</span> <span class="n">segment_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span> <span class="o">=</span> <span class="n">overlap_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_name</span> <span class="o">=</span> <span class="n">window_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="n">shots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">flatten</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;segment_length must be a positive integer and a power of 2.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;overlap_ratio must be a number in [0, 1).&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shots</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;shots must be a positive integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`flatten` must be a boolean.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_quantum_spectrum_for_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the &#39;quantum spectrum&#39; for a single signal segment using QFT</span>
<span class="sd">        and simulated measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment_data</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Segment length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">segment_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> must match &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;transformer&#39;s segment_length </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">segment_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">)</span>

        <span class="n">normalized_segment</span> <span class="o">=</span> <span class="n">segment_data</span> <span class="o">/</span> <span class="n">norm</span>

        <span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_qubits</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_qubits</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
        <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">cr</span><span class="p">)</span>

        <span class="n">initial_state</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Statevector</span><span class="p">(</span><span class="n">normalized_segment</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">initial_state</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">qr</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

        <span class="n">qft_gate</span> <span class="o">=</span> <span class="n">QFT</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_qubits</span><span class="p">,</span> <span class="n">approximation_degree</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">do_swaps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">insert_barriers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;QFT&#39;</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qft_gate</span><span class="p">,</span> <span class="n">qr</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>

        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qr</span><span class="p">,</span> <span class="n">cr</span><span class="p">)</span>

        <span class="n">simulator</span> <span class="o">=</span> <span class="n">AerSimulator</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;statevector&#39;</span><span class="p">)</span>
        <span class="n">compiled_circuit</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">simulator</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">compiled_circuit</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shots</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_counts</span><span class="p">(</span><span class="n">qc</span><span class="p">)</span>

        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">):</span>
            <span class="n">binary_representation</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;0</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_qubits</span><span class="si">}</span><span class="s1">b&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">binary_representation</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
                <span class="n">probabilities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">binary_representation</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">shots</span>

        <span class="n">quantum_power_spectrum</span> <span class="o">=</span> <span class="n">probabilities</span> <span class="o">*</span> <span class="p">(</span><span class="n">norm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">quantum_power_spectrum</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the QSG transformer.</span>

<span class="sd">        Validates input and parameters. Determines fixed dimensions for the</span>
<span class="sd">        output spectrograms based on `n_features_in_` (length of time series).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">_n_qubits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overlap_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overlap_samples</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;segment_length (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="si">}</span><span class="s2">) and overlap_ratio &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span><span class="si">}</span><span class="s2">) result in a non-positive stride &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_stride</span><span class="si">}</span><span class="s2">). Decrease overlap_ratio or increase segment_length.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid window_name: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="si">}</span><span class="s2">&#39;. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># noqa: B904</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_freq_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_fitted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform time series into Quantum Spectrograms.&quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_is_fitted&#39;</span><span class="p">,</span> <span class="s1">&#39;_n_qubits&#39;</span><span class="p">,</span> <span class="s1">&#39;_overlap_samples&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;_stride&#39;</span><span class="p">,</span> <span class="s1">&#39;_window&#39;</span><span class="p">,</span> <span class="s1">&#39;_num_freq_bins&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;_num_time_segments&#39;</span><span class="p">,</span> <span class="s1">&#39;_effective_length_for_transform&#39;</span><span class="p">])</span>

        <span class="n">X_orig</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">X_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Input has </span><span class="si">{</span><span class="n">X_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> features (timestamps), but transformer &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;was fitted with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> features.&quot;</span>
            <span class="p">)</span>

        <span class="n">X_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">X_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">all_spectrograms_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">signal_single</span> <span class="o">=</span> <span class="n">X_processed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">current_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal_single</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">current_len</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span><span class="p">:</span>
                <span class="n">pad_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span> <span class="o">-</span> <span class="n">current_len</span>
                <span class="n">signal_padded_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">signal_single</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_amount</span><span class="p">),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">current_len</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span><span class="p">:</span>
                <span class="n">signal_padded_final</span> <span class="o">=</span> <span class="n">signal_single</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">signal_padded_final</span> <span class="o">=</span> <span class="n">signal_single</span>

            <span class="n">q_spectrogram_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_freq_bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">all_spectrograms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q_spectrogram_ts</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="n">signal_padded_final</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">:</span>
                    <span class="n">segment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">windowed_segment</span> <span class="o">=</span> <span class="n">segment</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_window</span>
                <span class="n">full_q_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_quantum_spectrum_for_segment</span><span class="p">(</span><span class="n">windowed_segment</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
                <span class="n">q_spectrogram_ts</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_q_spectrum</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_freq_bins</span><span class="p">]</span>

            <span class="n">all_spectrograms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q_spectrogram_ts</span><span class="p">)</span>

        <span class="n">output_spectrograms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_spectrograms_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output_spectrograms</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output_spectrograms</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QSG.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fit the QSG transformer.</p>
<p>Validates input and parameters. Determines fixed dimensions for the
output spectrograms based on <code>n_features_in_</code> (length of time series).</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qsg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit the QSG transformer.</span>

<span class="sd">    Validates input and parameters. Determines fixed dimensions for the</span>
<span class="sd">    output spectrograms based on `n_features_in_` (length of time series).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> 

    <span class="bp">self</span><span class="o">.</span><span class="n">_n_qubits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_overlap_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overlap_samples</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;segment_length (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="si">}</span><span class="s2">) and overlap_ratio &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlap_ratio</span><span class="si">}</span><span class="s2">) result in a non-positive stride &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_stride</span><span class="si">}</span><span class="s2">). Decrease overlap_ratio or increase segment_length.&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_window</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid window_name: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_name</span><span class="si">}</span><span class="s2">&#39;. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># noqa: B904</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_num_freq_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_is_fitted</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="qts2d.encoding.QSG.transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Transform time series into Quantum Spectrograms.</p>


            <details class="quote">
              <summary>Source code in <code>qts2d\encoding\qsg.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform time series into Quantum Spectrograms.&quot;&quot;&quot;</span>
    <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_is_fitted&#39;</span><span class="p">,</span> <span class="s1">&#39;_n_qubits&#39;</span><span class="p">,</span> <span class="s1">&#39;_overlap_samples&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;_stride&#39;</span><span class="p">,</span> <span class="s1">&#39;_window&#39;</span><span class="p">,</span> <span class="s1">&#39;_num_freq_bins&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;_num_time_segments&#39;</span><span class="p">,</span> <span class="s1">&#39;_effective_length_for_transform&#39;</span><span class="p">])</span>

    <span class="n">X_orig</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">X_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Input has </span><span class="si">{</span><span class="n">X_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> features (timestamps), but transformer &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;was fitted with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="si">}</span><span class="s2"> features.&quot;</span>
        <span class="p">)</span>

    <span class="n">X_processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">X_orig</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="n">n_samples</span> <span class="o">=</span> <span class="n">X_processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">all_spectrograms_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">signal_single</span> <span class="o">=</span> <span class="n">X_processed</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">current_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal_single</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_len</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span><span class="p">:</span>
            <span class="n">pad_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span> <span class="o">-</span> <span class="n">current_len</span>
            <span class="n">signal_padded_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">signal_single</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_amount</span><span class="p">),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">current_len</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span><span class="p">:</span>
            <span class="n">signal_padded_final</span> <span class="o">=</span> <span class="n">signal_single</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_effective_length_for_transform</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signal_padded_final</span> <span class="o">=</span> <span class="n">signal_single</span>

        <span class="n">q_spectrogram_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_freq_bins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">all_spectrograms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q_spectrogram_ts</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_time_segments</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stride</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span>
            <span class="n">segment</span> <span class="o">=</span> <span class="n">signal_padded_final</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span><span class="p">:</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">windowed_segment</span> <span class="o">=</span> <span class="n">segment</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_window</span>
            <span class="n">full_q_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_quantum_spectrum_for_segment</span><span class="p">(</span><span class="n">windowed_segment</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
            <span class="n">q_spectrogram_ts</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_q_spectrum</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_freq_bins</span><span class="p">]</span>

        <span class="n">all_spectrograms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q_spectrogram_ts</span><span class="p">)</span>

    <span class="n">output_spectrograms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_spectrograms_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output_spectrograms</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output_spectrograms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>